<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suppliers & Purchases - Kaviraj Agro Agency</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-green-800 text-white fixed h-full">
            <div class="p-6">
                <h1 class="text-2xl font-bold mb-2">üåæKaviraj Agro Agency</h1>
                <p class="text-green-200 text-sm">Management</p>
            </div>
            <nav class="mt-6">
                <a href="index.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-dashboard mr-3"></i>
                    Dashboard
                </a>
                <a href="products.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-box mr-3"></i>
                    Products
                </a>
                <a href="stock.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-warehouse mr-3"></i>
                    Stock
                </a>
                <a href="billing.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-receipt mr-3"></i>
                    Billing
                </a>
                <a href="due.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-money-bill-wave mr-3"></i>
                    Due Amounts
                </a>
                <a href="customers.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-users mr-3"></i>
                    Customers
                </a>
                <a href="suppliers.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-truck mr-3"></i>
                    Suppliers & Purchases
                </a>
                <a href="reports.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-file-invoice mr-3"></i>
                    Financial Reports
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 ml-64 p-8 overflow-y-auto">
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">Supplier Management</h2>
                    <p class="text-gray-600">Manage suppliers and purchase records</p>
                </div>
                <button onclick="openAddSupplierModal()"
                    class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition flex items-center">
                    <i class="fas fa-plus mr-2"></i>
                    Add Supplier
                </button>
            </header>

            <!-- Search and Filter -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex gap-4">
                    <input type="text" id="searchSupplier" placeholder="Search suppliers..."
                        class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <button onclick="searchSuppliers()"
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-search mr-2"></i>Search
                    </button>
                </div>
            </div>

            <!-- Suppliers Grid -->
            <div id="suppliersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Supplier cards will be dynamically added here -->
            </div>

            <!-- Footer -->
            <footer class="mt-12 pt-8 pb-6 bg-white rounded-lg shadow-lg border border-gray-200">
                <div class="text-center">
                    <div class="flex items-center justify-center gap-2 mb-3">
                        <span class="text-gray-600 text-lg">Made with</span>
                        <span class="text-red-500 text-2xl animate-bounce">‚ù§Ô∏è</span>
                        <span class="text-gray-600 text-lg">by</span>
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-green-600 via-green-700 to-emerald-700 text-2xl font-bold">Satyajit
                            Bahir</span>

                    </div>

                    <div class="flex justify-center gap-4 mb-3">
                        <a href="#" class="text-blue-600 hover:text-blue-800 transition">
                            <i class="fab fa-linkedin text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-800 hover:text-gray-600 transition">
                            <i class="fab fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-blue-400 hover:text-blue-600 transition">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                    </div>
                    <p class="text-xs text-gray-500">¬© 2025 Kaviraj Agro Agency. All rights reserved.</p>
                </div>
            </footer>
        </main>
    </div>

    <!-- Add/Edit Supplier Modal -->
    <div id="supplierModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="supplierModalTitle">Add New Supplier</h3>
                <button onclick="closeSupplierModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="supplierForm" onsubmit="saveSupplier(event)">
                <input type="hidden" id="supplierId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Supplier Name *</label>
                        <input type="text" id="supplierName" required
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Contact Number</label>
                        <input type="tel" id="supplierContact"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">GST Number</label>
                        <input type="text" id="supplierGST"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold mb-2">Email</label>
                        <input type="email" id="supplierEmail"
                            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-gray-700 font-semibold mb-2">Address</label>
                    <textarea id="supplierAddress" rows="3"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                </div>
                <div class="mt-6 flex justify-end gap-4">
                    <button type="button" onclick="closeSupplierModal()"
                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Cancel</button>
                    <button type="submit"
                        class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">Save
                        Supplier</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Purchase Records Modal -->
    <div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-7xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="purchaseModalTitle">Purchase Records</h3>
                <button onclick="closePurchaseModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Add Purchase Form -->
            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                <h4 class="text-lg font-semibold text-gray-800 mb-4">Add New Purchase</h4>
                <form id="purchaseForm" onsubmit="savePurchase(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Date *</label>
                            <input type="date" id="purchaseDate" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Product *</label>
                            <input type="text" id="productName" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Quantity *</label>
                            <input type="number" id="quantity" min="0" step="0.01" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Unit *</label>
                            <select id="unit" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="kg">Kg</option>
                                <option value="ltr">Ltr</option>
                                <option value="pcs">Pcs</option>
                                <option value="bag">Bag</option>
                                <option value="box">Box</option>
                                <option value="packet">Packet</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Total Payment (‚Çπ) *</label>
                            <input type="number" id="totalPayment" min="0" step="0.01" required oninput="calculateDue()"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Paid Payment (‚Çπ) *</label>
                            <input type="number" id="paidPayment" min="0" step="0.01" required oninput="calculateDue()"
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Due Payment (‚Çπ)</label>
                            <input type="number" id="duePayment" readonly
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-gray-200 cursor-not-allowed">
                        </div>
                    </div>
                    <div class="mt-4">
                        <button type="submit"
                            class="w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition">
                            <i class="fas fa-plus mr-2"></i>Add Purchase
                        </button>
                    </div>
                </form>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                    <span class="text-sm text-blue-700 block mb-1">Total Purchases</span>
                    <span id="totalPurchases" class="text-2xl font-bold text-blue-900">‚Çπ0.00</span>
                </div>
                <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4">
                    <span class="text-sm text-green-700 block mb-1">Total Paid</span>
                    <span id="totalPaid" class="text-2xl font-bold text-green-900">‚Çπ0.00</span>
                </div>
                <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4">
                    <span class="text-sm text-red-700 block mb-1">Total Due</span>
                    <span id="totalDue" class="text-2xl font-bold text-red-900">‚Çπ0.00</span>
                </div>
            </div>

            <!-- Purchase History Table -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <h4 class="text-lg font-semibold text-gray-800 p-4 bg-gray-50 border-b">Purchase History</h4>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Date</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Product</th>
                                <th class="text-left py-4 px-6 font-semibold text-gray-700">Quantity</th>
                                <th class="text-center py-4 px-6 font-semibold text-gray-700">Total (‚Çπ)</th>
                                <th class="text-center py-4 px-6 font-semibold text-gray-700">Paid (‚Çπ)</th>
                                <th class="text-center py-4 px-6 font-semibold text-gray-700">Due (‚Çπ)</th>
                                <th class="text-center py-4 px-6 font-semibold text-gray-700">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseTableBody">
                            <tr>
                                <td colspan="7" class="text-center py-8 text-gray-500">No purchase records found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let suppliers = JSON.parse(localStorage.getItem('kavirajSuppliers')) || [];
        let currentSupplierId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            displaySuppliers();
            setTodayDate();
        });

        // Set today's date as default
        function setTodayDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDate').value = today;
        }

        // Calculate Due Payment
        function calculateDue() {
            const total = parseFloat(document.getElementById('totalPayment').value) || 0;
            const paid = parseFloat(document.getElementById('paidPayment').value) || 0;
            document.getElementById('duePayment').value = (total - paid).toFixed(2);
        }

        // Display Suppliers
        function displaySuppliers(suppliersToShow = suppliers) {
            const grid = document.getElementById('suppliersGrid');

            if (suppliersToShow.length === 0) {
                grid.innerHTML = '<div class="col-span-full bg-white rounded-lg shadow-md p-8 text-center text-gray-500">No suppliers found. Add your first supplier!</div>';
                return;
            }

            grid.innerHTML = suppliersToShow.map(supplier => {
                const stats = calculateSupplierStats(supplier);
                return `
                    <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition cursor-pointer" onclick="openPurchaseModal('${supplier.id}')">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-1">${supplier.name}</h3>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">
                                    ${supplier.purchases ? supplier.purchases.length : 0} Purchases
                                </span>
                            </div>
                            <button onclick="event.stopPropagation(); editSupplier('${supplier.id}')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="text-sm text-gray-600 flex items-center">
                                <i class="fas fa-phone w-5"></i>
                                ${supplier.contact || 'N/A'}
                            </div>
                            <div class="text-sm text-gray-600 flex items-center">
                                <i class="fas fa-envelope w-5"></i>
                                ${supplier.email || 'N/A'}
                            </div>
                            <div class="text-sm text-gray-600 flex items-center">
                                <i class="fas fa-file-invoice w-5"></i>
                                GST: ${supplier.gst || 'N/A'}
                            </div>
                            <div class="text-sm text-gray-600 flex items-center">
                                <i class="fas fa-map-marker-alt w-5"></i>
                                ${supplier.address || 'N/A'}
                            </div>
                        </div>
                        <div class="border-t pt-4 flex justify-between">
                            <div>
                                <span class="text-xs text-gray-500 block">Total Purchases</span>
                                <span class="text-lg font-bold text-blue-600">‚Çπ${stats.totalPurchases.toFixed(2)}</span>
                            </div>
                            <div>
                                <span class="text-xs text-gray-500 block">Total Due</span>
                                <span class="text-lg font-bold text-red-600">‚Çπ${stats.totalDue.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Calculate Supplier Statistics
        function calculateSupplierStats(supplier) {
            if (!supplier.purchases || supplier.purchases.length === 0) {
                return { totalPurchases: 0, totalPaid: 0, totalDue: 0 };
            }

            const totalPurchases = supplier.purchases.reduce((sum, p) => sum + parseFloat(p.total), 0);
            const totalPaid = supplier.purchases.reduce((sum, p) => sum + parseFloat(p.paid), 0);
            const totalDue = totalPurchases - totalPaid;

            return { totalPurchases, totalPaid, totalDue };
        }

        // Open Add Supplier Modal
        function openAddSupplierModal() {
            document.getElementById('supplierModalTitle').textContent = 'Add New Supplier';
            document.getElementById('supplierForm').reset();
            document.getElementById('supplierId').value = '';
            currentSupplierId = null;
            document.getElementById('supplierModal').classList.remove('hidden');
            document.getElementById('supplierModal').classList.add('flex');
        }

        // Close Supplier Modal
        function closeSupplierModal() {
            document.getElementById('supplierModal').classList.add('hidden');
            document.getElementById('supplierModal').classList.remove('flex');
        }

        // Save Supplier
        function saveSupplier(event) {
            event.preventDefault();

            const supplier = {
                id: currentSupplierId || Date.now().toString(),
                name: document.getElementById('supplierName').value,
                contact: document.getElementById('supplierContact').value,
                gst: document.getElementById('supplierGST').value,
                email: document.getElementById('supplierEmail').value,
                address: document.getElementById('supplierAddress').value,
                purchases: currentSupplierId ?
                    suppliers.find(s => s.id === currentSupplierId).purchases : []
            };

            if (currentSupplierId) {
                const index = suppliers.findIndex(s => s.id === currentSupplierId);
                suppliers[index] = supplier;
            } else {
                suppliers.push(supplier);
            }

            localStorage.setItem('kavirajSuppliers', JSON.stringify(suppliers));
            displaySuppliers();
            closeSupplierModal();
            alert(currentSupplierId ? 'Supplier updated successfully!' : 'Supplier added successfully!');
        }

        // Edit Supplier
        function editSupplier(id) {
            const supplier = suppliers.find(s => s.id === id);
            if (supplier) {
                currentSupplierId = id;
                document.getElementById('supplierModalTitle').textContent = 'Edit Supplier';
                document.getElementById('supplierId').value = supplier.id;
                document.getElementById('supplierName').value = supplier.name;
                document.getElementById('supplierContact').value = supplier.contact || '';
                document.getElementById('supplierGST').value = supplier.gst || '';
                document.getElementById('supplierEmail').value = supplier.email || '';
                document.getElementById('supplierAddress').value = supplier.address || '';
                document.getElementById('supplierModal').classList.remove('hidden');
                document.getElementById('supplierModal').classList.add('flex');
            }
        }

        // Open Purchase Modal
        function openPurchaseModal(supplierId) {
            currentSupplierId = supplierId;
            const supplier = suppliers.find(s => s.id === supplierId);

            document.getElementById('purchaseModalTitle').textContent =
                `Purchase Records - ${supplier.name}`;

            document.getElementById('purchaseForm').reset();
            setTodayDate();
            displayPurchaseHistory(supplier);
            updateSummary(supplier);
            document.getElementById('purchaseModal').classList.remove('hidden');
            document.getElementById('purchaseModal').classList.add('flex');
        }

        // Close Purchase Modal
        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            document.getElementById('purchaseModal').classList.remove('flex');
        }

        // Save Purchase
        function savePurchase(event) {
            event.preventDefault();

            const supplier = suppliers.find(s => s.id === currentSupplierId);

            const purchase = {
                id: Date.now().toString(),
                date: document.getElementById('purchaseDate').value,
                product: document.getElementById('productName').value,
                quantity: parseFloat(document.getElementById('quantity').value),
                unit: document.getElementById('unit').value,
                total: parseFloat(document.getElementById('totalPayment').value),
                paid: parseFloat(document.getElementById('paidPayment').value),
                due: parseFloat(document.getElementById('duePayment').value)
            };

            if (!supplier.purchases) {
                supplier.purchases = [];
            }

            supplier.purchases.push(purchase);
            localStorage.setItem('kavirajSuppliers', JSON.stringify(suppliers));
            displaySuppliers();
            displayPurchaseHistory(supplier);
            updateSummary(supplier);
            document.getElementById('purchaseForm').reset();
            setTodayDate();
            alert('Purchase added successfully!');
        }

        // Display Purchase History
        function displayPurchaseHistory(supplier) {
            const tbody = document.getElementById('purchaseTableBody');

            if (!supplier.purchases || supplier.purchases.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No purchase records found. Add your first purchase above!</td></tr>';
                return;
            }

            tbody.innerHTML = supplier.purchases
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(purchase => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-4 px-6">${formatDate(purchase.date)}</td>
                        <td class="py-4 px-6">${purchase.product}</td>
                        <td class="py-4 px-6">${purchase.quantity} ${purchase.unit}</td>
                        <td class="py-4 px-6 text-center font-semibold">‚Çπ${purchase.total.toFixed(2)}</td>
                        <td class="py-4 px-6 text-center font-semibold">‚Çπ${purchase.paid.toFixed(2)}</td>
                        <td class="py-4 px-6 text-center font-semibold ${purchase.due > 0 ? 'text-red-600' : 'text-green-600'}">
                            ‚Çπ${purchase.due.toFixed(2)}
                        </td>
                        <td class="py-4 px-6 text-center">
                            <button onclick="deletePurchase('${supplier.id}', '${purchase.id}')" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
        }

        // Update Summary
        function updateSummary(supplier) {
            const stats = calculateSupplierStats(supplier);

            document.getElementById('totalPurchases').textContent = `‚Çπ${stats.totalPurchases.toFixed(2)}`;
            document.getElementById('totalPaid').textContent = `‚Çπ${stats.totalPaid.toFixed(2)}`;
            document.getElementById('totalDue').textContent = `‚Çπ${stats.totalDue.toFixed(2)}`;
        }

        // Delete Purchase
        function deletePurchase(supplierId, purchaseId) {
            if (!confirm('Are you sure you want to delete this purchase record?')) return;

            const supplier = suppliers.find(s => s.id === supplierId);
            supplier.purchases = supplier.purchases.filter(p => p.id !== purchaseId);

            localStorage.setItem('kavirajSuppliers', JSON.stringify(suppliers));
            displaySuppliers();
            displayPurchaseHistory(supplier);
            updateSummary(supplier);
            alert('Purchase deleted successfully!');
        }

        // Format Date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-IN', options);
        }

        // Search Suppliers
        function searchSuppliers() {
            const searchTerm = document.getElementById('searchSupplier').value.toLowerCase();

            const filtered = suppliers.filter(s =>
                s.name.toLowerCase().includes(searchTerm) ||
                (s.contact && s.contact.toLowerCase().includes(searchTerm)) ||
                (s.gst && s.gst.toLowerCase().includes(searchTerm))
            );

            displaySuppliers(filtered);
        }

        // Search on input
        document.getElementById('searchSupplier').addEventListener('input', searchSuppliers);
    </script>
</body>

</html>