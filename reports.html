<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Reports - Kaviraj Agro Agency</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-green-800 text-white fixed h-full">
            <div class="p-6">
                <h1 class="text-2xl font-bold mb-2">üåæKaviraj Agro Agency</h1>
                <p class="text-green-200 text-sm">Management</p>
            </div>
            <nav class="mt-6">
                <a href="index.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-dashboard mr-3"></i>
                    Dashboard
                </a>
                <a href="products.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-box mr-3"></i>
                    Products
                </a>
                <a href="stock.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-warehouse mr-3"></i>
                    Stock
                </a>
                <a href="billing.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-receipt mr-3"></i>
                    Billing
                </a>
                <a href="due.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-money-bill-wave mr-3"></i>
                    Due Amounts
                </a>
                <a href="customers.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-users mr-3"></i>
                    Customers
                </a>
                <a href="suppliers.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-truck mr-3"></i>
                    Suppliers & Purchases
                </a>
                <a href="reports.html" class="flex items-center px-6 py-3 hover:bg-green-700 transition">
                    <i class="fas fa-file-invoice mr-3"></i>
                    Financial Reports
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 ml-64 p-8 overflow-y-auto">
            <!-- Header -->
            <header class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Financial Reports</h2>
                <p class="text-gray-600">Download monthly reports for tax compliance and business analysis</p>
            </header>

            <!-- Date Filter Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-calendar-alt text-green-600 mr-2"></i>
                    Select Report Period
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Month</label>
                        <select id="reportMonth"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none">
                            <option value="0">January</option>
                            <option value="1">February</option>
                            <option value="2">March</option>
                            <option value="3">April</option>
                            <option value="4">May</option>
                            <option value="5">June</option>
                            <option value="6">July</option>
                            <option value="7">August</option>
                            <option value="8">September</option>
                            <option value="9">October</option>
                            <option value="10">November</option>
                            <option value="11">December</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Year</label>
                        <select id="reportYear"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none">
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="generateReportSummary()"
                            class="w-full bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition font-semibold">
                            <i class="fas fa-chart-bar mr-2"></i>Generate Summary
                        </button>
                    </div>
                </div>
            </div>

            <!-- Report Summary -->
            <div id="reportSummary" class="bg-white rounded-lg shadow-md p-6 mb-8 hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-green-600 mr-2"></i>
                    Report Summary
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm text-gray-600 font-medium">Total Sales</p>
                            <div class="bg-blue-500 p-2 rounded-full">
                                <i class="fas fa-rupee-sign text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="totalSales" class="text-3xl font-bold text-blue-600">‚Çπ0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm text-gray-600 font-medium">Stock Added</p>
                            <div class="bg-green-500 p-2 rounded-full">
                                <i class="fas fa-warehouse text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="totalStock" class="text-3xl font-bold text-green-600">‚Çπ0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 p-6 rounded-lg shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm text-gray-600 font-medium">Total Due</p>
                            <div class="bg-yellow-500 p-2 rounded-full">
                                <i class="fas fa-exclamation-circle text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="totalDue" class="text-3xl font-bold text-yellow-600">‚Çπ0.00</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-lg shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-sm text-gray-600 font-medium">Total Bills</p>
                            <div class="bg-purple-500 p-2 rounded-full">
                                <i class="fas fa-receipt text-white text-sm"></i>
                            </div>
                        </div>
                        <p id="totalBills" class="text-3xl font-bold text-purple-600">0</p>
                    </div>
                </div>
            </div>

            <!-- Download Reports Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-download text-green-600 mr-2"></i>
                    Download Reports
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Sales Report -->
                    <div
                        class="border-2 border-gray-200 rounded-lg p-6 hover:border-blue-500 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="bg-blue-100 p-3 rounded-lg mr-3">
                                        <i class="fas fa-file-invoice text-blue-600 text-2xl"></i>
                                    </div>
                                    <h4 class="font-bold text-lg text-gray-800">Sales Report</h4>
                                </div>
                                <p class="text-sm text-gray-600">Complete sales transactions with customer details and
                                    payment information</p>
                            </div>
                        </div>
                        <button onclick="downloadSalesReport()"
                            class="w-full bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-md">
                            <i class="fas fa-download mr-2"></i>Download CSV
                        </button>
                    </div>

                    <!-- Stock Report -->
                    <div
                        class="border-2 border-gray-200 rounded-lg p-6 hover:border-green-500 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="bg-green-100 p-3 rounded-lg mr-3">
                                        <i class="fas fa-boxes text-green-600 text-2xl"></i>
                                    </div>
                                    <h4 class="font-bold text-lg text-gray-800">Stock Purchase Report</h4>
                                </div>
                                <p class="text-sm text-gray-600">All stock additions, purchases and supplier information
                                </p>
                            </div>
                        </div>
                        <button onclick="downloadStockReport()"
                            class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition font-semibold shadow-md">
                            <i class="fas fa-download mr-2"></i>Download CSV
                        </button>
                    </div>

                    <!-- Due Payments Report -->
                    <div
                        class="border-2 border-gray-200 rounded-lg p-6 hover:border-yellow-500 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="bg-yellow-100 p-3 rounded-lg mr-3">
                                        <i class="fas fa-money-check-alt text-yellow-600 text-2xl"></i>
                                    </div>
                                    <h4 class="font-bold text-lg text-gray-800">Due Payments Report</h4>
                                </div>
                                <p class="text-sm text-gray-600">All pending and cleared due payments with history</p>
                            </div>
                        </div>
                        <button onclick="downloadDueReport()"
                            class="w-full bg-yellow-600 text-white px-4 py-3 rounded-lg hover:bg-yellow-700 transition font-semibold shadow-md">
                            <i class="fas fa-download mr-2"></i>Download CSV
                        </button>
                    </div>

                    <!-- Customer Report -->
                    <div
                        class="border-2 border-gray-200 rounded-lg p-6 hover:border-purple-500 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="bg-purple-100 p-3 rounded-lg mr-3">
                                        <i class="fas fa-users text-purple-600 text-2xl"></i>
                                    </div>
                                    <h4 class="font-bold text-lg text-gray-800">Customer Report</h4>
                                </div>
                                <p class="text-sm text-gray-600">Customer purchase history and contact information</p>
                            </div>
                        </div>
                        <button onclick="downloadCustomerReport()"
                            class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition font-semibold shadow-md">
                            <i class="fas fa-download mr-2"></i>Download CSV
                        </button>
                    </div>

                    <!-- Suppliers Report -->
                    <div
                        class="border-2 border-gray-200 rounded-lg p-6 hover:border-orange-500 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <div class="bg-orange-100 p-3 rounded-lg mr-3">
                                        <i class="fas fa-truck text-orange-600 text-2xl"></i>
                                    </div>
                                    <h4 class="font-bold text-lg text-gray-800">Suppliers Report</h4>
                                </div>
                                <p class="text-sm text-gray-600">Stock received from suppliers, payments, dues, and
                                    purchase details</p>
                            </div>
                        </div>
                        <button onclick="openSuppliersReportModal()"
                            class="w-full bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700 transition font-semibold shadow-md">
                            <i class="fas fa-download mr-2"></i>Select & Download CSV
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="mt-12 pt-8 pb-6 bg-white rounded-lg shadow-lg border border-gray-200">
                <div class="text-center">
                    <div class="flex items-center justify-center gap-2 mb-3">
                        <span class="text-gray-600 text-lg">Made with</span>
                        <span class="text-red-500 text-2xl animate-bounce">‚ù§Ô∏è</span>
                        <span class="text-gray-600 text-lg">by</span>
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-green-600 via-green-700 to-emerald-700 text-2xl font-bold">Satyajit
                            Bahir</span>

                    </div>

                    <div class="flex justify-center gap-4 mb-3">
                        <a href="#" class="text-blue-600 hover:text-blue-800 transition">
                            <i class="fab fa-linkedin text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-800 hover:text-gray-600 transition">
                            <i class="fab fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-blue-400 hover:text-blue-600 transition">
                            <i class="fab fa-twitter text-xl"></i>
                        </a>
                    </div>
                    <p class="text-xs text-gray-500">¬© 2025 Kaviraj Agro Agency. All rights reserved.</p>
                </div>
            </footer>
        </main>
    </div>

    <!-- Suppliers Report Modal -->
    <div id="suppliersReportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Suppliers Report</h3>
                <button onclick="closeSuppliersReportModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <form id="suppliersReportForm" onsubmit="downloadSuppliersReport(event)">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Supplier *</label>
                        <select id="supplierSelect" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none">
                            <option value="">Choose a supplier...</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">From Date *</label>
                            <input type="date" id="fromDate" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">To Date *</label>
                            <input type="date" id="toDate" required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:outline-none">
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-4">
                    <button type="button" onclick="closeSuppliersReportModal()"
                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">Cancel</button>
                    <button type="submit"
                        class="px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                        <i class="fas fa-download mr-2"></i>Download CSV
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize year dropdown
        function initializeYearDropdown() {
            const yearSelect = document.getElementById('reportYear');
            const currentYear = new Date().getFullYear();

            // Add last 5 years
            for (let i = 0; i < 5; i++) {
                const year = currentYear - i;
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (i === 0) option.selected = true;
                yearSelect.appendChild(option);
            }

            // Set current month
            document.getElementById('reportMonth').value = new Date().getMonth();
        }

        // Generate report summary
        function generateReportSummary() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);

            // Get data from localStorage
            const bills = JSON.parse(localStorage.getItem('bills') || '[]');
            const dueAmounts = JSON.parse(localStorage.getItem('dueAmounts') || '[]');
            const stockHistory = JSON.parse(localStorage.getItem('stockHistory') || '[]');

            // Filter data for selected month/year
            const filteredBills = bills.filter(bill => {
                const billDate = new Date(bill.date);
                return billDate.getMonth() === month && billDate.getFullYear() === year;
            });

            const filteredStock = stockHistory.filter(stock => {
                const stockDate = new Date(stock.date);
                return stockDate.getMonth() === month && stockDate.getFullYear() === year;
            });

            // Calculate totals
            const totalSales = filteredBills.reduce((sum, bill) => sum + (bill.total || 0), 0);
            const totalStock = filteredStock.reduce((sum, stock) => sum + (stock.totalCost || 0), 0);
            const totalDue = dueAmounts.reduce((sum, due) => sum + (due.dueAmount || 0), 0);

            // Update UI
            document.getElementById('totalSales').textContent = '‚Çπ' + totalSales.toFixed(2);
            document.getElementById('totalStock').textContent = '‚Çπ' + totalStock.toFixed(2);
            document.getElementById('totalDue').textContent = '‚Çπ' + totalDue.toFixed(2);
            document.getElementById('totalBills').textContent = filteredBills.length;

            document.getElementById('reportSummary').classList.remove('hidden');
        }

        // Download Sales Report
        function downloadSalesReport() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const bills = JSON.parse(localStorage.getItem('bills') || '[]');

            // Filter bills for selected period
            const filteredBills = bills.filter(bill => {
                const billDate = new Date(bill.date);
                return billDate.getMonth() === month && billDate.getFullYear() === year;
            });

            if (filteredBills.length === 0) {
                alert('No sales data found for the selected period.');
                return;
            }

            // Create CSV content
            let csvContent = 'Bill No,Date,Time,Customer Name,Sub Total,Discount,Total Amount,Payment Type,Due Amount,Paid Amount,Items Count\n';

            filteredBills.forEach(bill => {
                const date = new Date(bill.date);
                const dateStr = date.toLocaleDateString('en-IN');
                const timeStr = date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });

                csvContent += `${bill.billNo},${dateStr},${timeStr},"${bill.customerName}",${bill.subTotal || 0},${bill.discount || 0},${bill.total},${bill.paymentType},${bill.dueAmount || 0},${bill.paidAmount || 0},${bill.items?.length || 0}\n`;
            });

            // Download CSV
            downloadCSV(csvContent, `Sales_Report_${getMonthName(month)}_${year}.csv`);
        }

        // Download Stock Report
        function downloadStockReport() {
            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            const stockHistory = JSON.parse(localStorage.getItem('stockHistory') || '[]');

            const filteredStock = stockHistory.filter(stock => {
                const stockDate = new Date(stock.date);
                return stockDate.getMonth() === month && stockDate.getFullYear() === year;
            });

            if (filteredStock.length === 0) {
                alert('No stock data found for the selected period.');
                return;
            }

            // Create CSV content
            let csvContent = 'Date,Time,Product Name,Category,Quantity Added,Unit,Cost Per Unit,Total Cost,Supplier\n';

            filteredStock.forEach(stock => {
                const date = new Date(stock.date);
                const dateStr = date.toLocaleDateString('en-IN');
                const timeStr = date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });

                csvContent += `${dateStr},${timeStr},"${stock.productName}","${stock.category}",${stock.quantity},${stock.unit},${stock.costPerUnit},${stock.totalCost},"${stock.supplier || 'N/A'}"\n`;
            });

            downloadCSV(csvContent, `Stock_Report_${getMonthName(month)}_${year}.csv`);
        }

        // Download Due Report
        function downloadDueReport() {
            const dueAmounts = JSON.parse(localStorage.getItem('dueAmounts') || '[]');

            if (dueAmounts.length === 0) {
                alert('No due payment data found.');
                return;
            }

            // Create CSV content
            let csvContent = 'Bill ID,Farmer Name,Due Amount,Status,Bill Date,Payment History\n';

            dueAmounts.forEach(due => {
                const payments = due.payments ? due.payments.length : 0;
                const billDate = new Date(due.billDate).toLocaleDateString('en-IN');

                csvContent += `${due.billId},"${due.farmerName}",${due.dueAmount},${due.status},${billDate},${payments} payments\n`;
            });

            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            downloadCSV(csvContent, `Due_Payments_Report_${getMonthName(month)}_${year}.csv`);
        }

        // Download Customer Report
        function downloadCustomerReport() {
            const customers = JSON.parse(localStorage.getItem('customers') || '[]');

            if (customers.length === 0) {
                alert('No customer data found.');
                return;
            }

            // Create CSV content
            let csvContent = 'Customer Name,Phone,Village,Address,Total Purchases,Last Purchase Date\n';

            customers.forEach(customer => {
                const lastPurchase = customer.lastPurchase ? new Date(customer.lastPurchase).toLocaleDateString('en-IN') : 'N/A';

                csvContent += `"${customer.name}","${customer.phone || 'N/A'}","${customer.village || 'N/A'}","${customer.address || 'N/A'}",‚Çπ${customer.totalPurchases || 0},${lastPurchase}\n`;
            });

            const month = parseInt(document.getElementById('reportMonth').value);
            const year = parseInt(document.getElementById('reportYear').value);
            downloadCSV(csvContent, `Customer_Report_${getMonthName(month)}_${year}.csv`);
        }

        // Open Suppliers Report Modal
        function openSuppliersReportModal() {
            const suppliers = JSON.parse(localStorage.getItem('kavirajSuppliers') || '[]');
            const supplierSelect = document.getElementById('supplierSelect');

            // Clear existing options
            supplierSelect.innerHTML = '<option value="">Choose a supplier...</option>';

            // Add suppliers to dropdown
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                supplierSelect.appendChild(option);
            });

            // Set default date range (last 30 days)
            const today = new Date();
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(today.getDate() - 30);

            document.getElementById('fromDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('toDate').value = today.toISOString().split('T')[0];

            document.getElementById('suppliersReportModal').classList.remove('hidden');
            document.getElementById('suppliersReportModal').classList.add('flex');
        }

        // Close Suppliers Report Modal
        function closeSuppliersReportModal() {
            document.getElementById('suppliersReportModal').classList.add('hidden');
            document.getElementById('suppliersReportModal').classList.remove('flex');
        }

        // Download Suppliers Report
        function downloadSuppliersReport(event) {
            event.preventDefault();

            const supplierId = document.getElementById('supplierSelect').value;
            const fromDate = new Date(document.getElementById('fromDate').value);
            const toDate = new Date(document.getElementById('toDate').value);

            if (!supplierId) {
                alert('Please select a supplier.');
                return;
            }

            if (fromDate > toDate) {
                alert('From date cannot be later than to date.');
                return;
            }

            const suppliers = JSON.parse(localStorage.getItem('kavirajSuppliers') || '[]');
            const supplier = suppliers.find(s => s.id === supplierId);

            if (!supplier) {
                alert('Supplier not found.');
                return;
            }

            if (!supplier.purchases || supplier.purchases.length === 0) {
                alert('No purchase records found for this supplier.');
                return;
            }

            // Filter purchases by date range
            const filteredPurchases = supplier.purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate >= fromDate && purchaseDate <= toDate;
            });

            if (filteredPurchases.length === 0) {
                alert('No purchase records found for the selected date range.');
                return;
            }

            // Create CSV content
            let csvContent = 'Date,Product,Quantity,Unit,Total Amount (‚Çπ),Paid Amount (‚Çπ),Due Amount (‚Çπ),Supplier Name,Contact,GST Number\n';

            filteredPurchases.forEach(purchase => {
                const date = new Date(purchase.date);
                const dateStr = date.toISOString().split('T')[0]; // YYYY-MM-DD format for Excel compatibility
                csvContent += `${dateStr},"${purchase.product}",${purchase.quantity},"${purchase.unit}",${purchase.total},${purchase.paid},${purchase.due},"${supplier.name}","${supplier.contact || 'N/A'}","${supplier.gst || 'N/A'}"\n`;
            });

            // Generate filename with supplier name and date range
            const fromDateStr = fromDate.toISOString().split('T')[0];
            const toDateStr = toDate.toISOString().split('T')[0];
            const filename = `Suppliers_Report_${supplier.name.replace(/[^a-zA-Z0-9]/g, '_')}_${fromDateStr}_to_${toDateStr}.csv`;

            downloadCSV(csvContent, filename);
            closeSuppliersReportModal();
        }

        // Helper function to download CSV
        function downloadCSV(csvContent, filename) {
            const BOM = '\uFEFF'; // UTF-8 BOM for proper Excel display
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.display = 'none';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Helper function to get month name
        function getMonthName(monthIndex) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            return months[monthIndex];
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeYearDropdown);
    </script>
</body>

</html>